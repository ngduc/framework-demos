var M=M||{};M.Version="1.2";var m_require=m_require||function require(){};var YES=true;var NO=false;M.LOCAL_STORAGE_PREFIX="#m#";M.LOCAL_STORAGE_SUFFIX="_";M.META_CREATED_AT="_createdAt";M.META_UPDATED_AT="_updatedAt";M.META_M_ID="_m_id";Object.getPrototypeOf(localStorage).clear=function(e){var a=this.length;if(e==="f"){var a=this.length;for(var c=a-1;c>=0;c--){this.removeItem(this.key(c))}}else{for(var c=a-1;c>=0;c--){var b=this.key(c);var d=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX).exec(b);if(d){this.removeItem(b)}}}};m_require("core/foundation/m.js");M.Object={type:"M.Object",create:function(a){var b=function(){};b.prototype=a;return new b()},include:function(a){for(var b in a){this[b]=a[b]}},extend:function(a){var b=M.Object.create(this);b.include(a);return b},bindToCaller:function(b,c,a){return function(){if(_.isArray(a)){return c.apply(b,a)}return c.call(b,a)}},get:function(a){return this[a]},set:function(a,b){this[a]=b},destroy:function(){if(this.id&&$("#"+this.id)){M.EventDispatcher.unregisterEvents(this);M.ViewManager.unregister(this);$("#"+this.id).remove()}delete this}};m_require("core/foundation/object.js");M.Request=M.Object.extend({type:"M.Request",method:"GET",url:null,isAsync:YES,isJSON:NO,timeout:null,callbacks:null,sendNoCacheHeader:YES,sendTimestamp:NO,data:null,request:null,init:function(a){a=a?a:{};return this.extend({method:a.method?a.method:this.method,url:a.url?a.url:this.url,isAsync:(a.isAsync!==undefined&&a.isAsync!==null)?a.isAsync:this.isAsync,isJSON:(a.isJSON!==undefined&&a.isJSON!==null)?a.isJSON:this.isJSON,timeout:a.timeout?a.timeout:this.timeout,data:a.data?a.data:this.data,callbacks:a.callbacks,sendNoCacheHeader:a.sendNoCacheHeader,sendTimestamp:a.sendTimestamp,beforeSend:a.beforeSend?a.beforeSend:this.beforeSend,onError:a.onError?a.onError:this.onError,onSuccess:a.onSuccess?a.onSuccess:this.onSuccess})},beforeSend:function(a){},onError:function(a,b){},onSuccess:function(b,c,a){},internalBeforeSend:function(a){if(this.sendNoCacheHeader){a.setRequestHeader("Cache-Control","no-cache")}if(!this.callbacks&&this.beforeSend){this.beforeSend(a)}if(this.callbacks&&this.callbacks.beforeSend&&M.EventDispatcher.checkHandler(this.callbacks.beforeSend)){M.EventDispatcher.callHandler(this.callbacks.beforeSend,null,NO,[a])}},internalOnError:function(a,b){if(!this.callbacks&&this.onError){this.onError(a,b)}if(this.callbacks&&this.callbacks.error&&M.EventDispatcher.checkHandler(this.callbacks.error)){M.EventDispatcher.callHandler(this.callbacks.error,null,NO,[a,b])}},internalOnSuccess:function(b,c,a){if(!this.callbacks&&this.onSuccess){this.onSuccess(b,c,a)}if(this.callbacks&&this.callbacks.success&&M.EventDispatcher.checkHandler(this.callbacks.success)){M.EventDispatcher.callHandler(this.callbacks.success,null,NO,[b,c,a])}},send:function(){this.request=$.ajax({type:this.method,url:this.url,async:this.isAsync,dataType:this.isJSON?"json":"text",contentType:this.isJSON?"application/json":"application/x-www-form-urlencoded",timeout:this.timeout,data:this.data?this.data:"",context:this,beforeSend:this.internalBeforeSend,success:this.internalOnSuccess,error:this.internalOnError,cache:!this.sendTimestamp})},abort:function(){if(this.request){this.request.abort();return YES}return NO}});m_require("core/foundation/object.js");M.MILLISECONDS="milliseconds";M.SECONDS="seconds";M.MINUTES="minutes";M.HOURS="hours";M.DAYS="days";M.DAY_NAMES=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];M.MONTH_NAMES=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"];M.Date=M.Object.extend({type:"M.Date",date:null,now:function(){return this.extend({date:new Date()})},tomorrow:function(){return this.daysFromNow(1)},yesterday:function(){return this.daysFromNow(-1)},create:function(c){var b=typeof(c)==="number"?c:null;if(!b){var d=/(\d{1,2})\.(\d{1,2})\.(\d{2,4})/.exec(c);if(d&&d[1]&&d[2]&&d[3]){var a=$.trim(c).split(" ");c=d[2]+"/"+d[1]+"/"+d[3]+(a[1]?" "+a[1]:"")}b=Date.parse(c)}if(c&&!b){M.Logger.log("Invalid dateString '"+c+"'.",M.WARN);return null}else{if(!c){return this.now()}}return this.extend({date:new Date(b)})},format:function(q,p){if(isNaN(this.date)){M.Logger.log("Invalid date!",M.WARN)}var g=/d{1,4}|D{1}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g;var j=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g;var i=/[^-+\dA-Z]/g;var f=function(m,d){m=String(m);d=d||2;while(m.length<d){m="0"+m}return m};if(arguments.length==1&&Object.prototype.toString.call(this.date)=="[object String]"&&!/\d/.test(this.date)){q=this.date;date=undefined}var t=p?"getUTC":"get";var k=this.date[t+"Date"]();var a=this.date[t+"Day"]();var e=this.date[t+"Month"]();var n=this.date[t+"FullYear"]();var r=this.date[t+"Hours"]();var h=this.date[t+"Minutes"]();var u=this.date[t+"Seconds"]();var l=this.date[t+"Milliseconds"]();var b=p?0:this.date.getTimezoneOffset();var c={d:k,dd:f(k),ddd:M.DAY_NAMES[a],dddd:M.DAY_NAMES[a+7],D:a,m:e+1,mm:f(e+1),mmm:M.MONTH_NAMES[e],mmmm:M.MONTH_NAMES[e+12],yy:String(n).slice(2),yyyy:n,h:r%12||12,hh:f(r%12||12),H:r,HH:f(r),M:h,MM:f(h),s:u,ss:f(u),l:f(l,3),L:f(l>99?Math.round(l/10):l),t:r<12?"a":"p",tt:r<12?"am":"pm",T:r<12?"A":"P",TT:r<12?"AM":"PM",Z:p?"UTC":(String(this.date).match(j)||[""]).pop().replace(i,""),o:(b>0?"-":"+")+f(Math.floor(Math.abs(b)/60)*100+Math.abs(b)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return q.replace(g,function(d){return d in c?c[d]:d.slice(1,d.length-1)})},getTimestamp:function(){if(this.date){return this.date.getTime()}return null},daysFromNow:function(b){var a=this.now();return a.daysFromDate(b)},daysFromDate:function(a){return this.millisecondsFromDate(a*24*60*60*1000)},hoursFromNow:function(a){var b=this.now();return b.hoursFromDate(a)},hoursFromDate:function(a){return this.millisecondsFromDate(a*60*60*1000)},minutesFromNow:function(b){var a=this.now();return a.minutesFromDate(b)},minutesFromDate:function(a){return this.millisecondsFromDate(a*60*1000)},secondsFromNow:function(b){var a=this.now();return a.secondsFromDate(b)},secondsFromDate:function(a){return this.millisecondsFromDate(a*1000)},millisecondsFromNow:function(b){var a=this.now();return a.millisecondsFromDate(b)},millisecondsFromDate:function(a){if(!this.date){M.Logger.log("no date specified!",M.ERR)}return this.extend({date:new Date(this.getTimestamp()+a)})},timeBetween:function(d,c){var b=this.date?this.getTimestamp():null;var a=d.date?d.getTimestamp():null;if(b&&a){switch(c){case M.DAYS:return(a-b)/(24*60*60*1000);break;case M.HOURS:return(a-b)/(60*60*1000);break;case M.MINUTES:return(a-b)/(60*1000);break;case M.SECONDS:return(a-b)/1000;break;case M.MILLISECONDS:default:return(a-b);break}}else{if(b){M.Logger.log("invalid date passed.",M.ERR)}else{M.Logger.log("invalid date.",M.ERR)}}},getCalendarWeek:function(g,e,i){if(!g){g=parseInt(this.format("yyyy"));e=parseInt(this.format("m"));i=parseInt(this.format("d"))}else{e+=1}var j=Math.floor((14-(e))/12);var h=g+4800-j;var d=(e)+(12*j)-3;var k=i+Math.floor(((153*d)+2)/5)+(365*h)+Math.floor(h/4)-Math.floor(h/100)+Math.floor(h/400)-32045;var l=(k+31741-(k%7))%146097%36524%1461;var f=Math.floor(l/1460);var c=((l-f)%365)+f;var b=Math.floor(c/7)+1;return b},getDatesOfCalendarWeek:function(a,k,h){h=h&&!isNaN(h)?h:(this.date?this.format("yyyy"):M.Date.now().format("yyyy"));var e=M.Date.create("01/01/"+h);var c=e.format("D");var j=null;if(k){j=c==1?e:e.daysFromDate(8-(c==0?7:c))}else{j=c==0?e:e.daysFromDate(7-c)}a=a?a:this.getCalendarWeek();var f=j.daysFromDate((a-1)*7);var b=[];for(var g=0;g<7;g++){var d=f.daysFromDate(g);d=M.Date.create(d.format("mm")+"/"+d.format("dd")+"/"+d.format("yyyy"));b.push(d)}return b},getDateByWeekdayAndCalendarWeek:function(c,a,b){if(c&&!isNaN(c)&&((a&&!isNaN(a))||a===0)){var d=M.Date.getDatesOfCalendarWeek(c,NO,b);if(d&&d.length>0&&d[a]){return d[a]}else{M.Logger.log("Day "+a+" of calendar week "+c+" could not be found!",M.ERR)}}else{M.Logger.log("Please pass a valid calendarWeek and a valid day of the week!",M.ERR)}},toJSON:function(){return String(this.date)}});m_require("core/foundation/object.js");M.DeviceSwitch=M.Object.extend({type:"M.DeviceSwitch",device:null,s:function(a){return this.specialize(a)},specialize:function(a){if(!this.device){M.Logger.log("No device specified!",M.ERR);return null}if(this[this.device]&&this[this.device][a]){return this[this.device][a]}else{M.Logger.log("Key '"+a+"' not defined for device '"+this.device+"'.",M.WARN);return null}}});M.DS=M.DeviceSwitch;m_require("core/foundation/object.js");M.OFFLINE="offline";M.ONLINE="online";M.PORTRAIT_TOP=0;M.PORTRAIT_BOTTOM=180;M.LANDSCAPE_RIGHT=-90;M.LANDSCAPE_LEFT=90;M.Environment=M.Object.extend({type:"M.Environment",modernizr:{inputtypes:(function(j){var a=document.documentElement;var e={};var d=":)";var k=document.createElement("input");for(var c=0,b,h,g,f=j.length;c<f;c++){k.setAttribute("type",h=j[c]);b=k.type!=="text";if(b){k.value=d;k.style.cssText="position:absolute;visibility:hidden;";if(/^range$/.test(h)&&k.style.WebkitAppearance!==undefined){a.appendChild(k);g=document.defaultView;b=g.getComputedStyle&&g.getComputedStyle(k,null).WebkitAppearance!=="textfield"&&k.offsetHeight!==0;a.removeChild(k)}else{if(/^(search|tel)$/.test(h)){}else{if(/^(url|email)$/.test(h)){b=k.checkValidity&&k.checkValidity()===false}else{if(/^color$/.test(h)){a.appendChild(k);b=k.value!=d;a.removeChild(k)}else{b=k.value!=d}}}}}e[j[c]]=!!b}return e})("search tel url email datetime date month week time datetime-local number range color".split(" ")),inputattributes:(function(f){var c=document.documentElement;var d={};var b=":)";var g=document.createElement("input");for(var e=0,a=f.length;e<a;e++){d[f[e]]=!!(f[e] in g)}if(d.list){d.list=!!(document.createElement("datalist")&&window.HTMLDataListElement)}return d})("autocomplete autofocus list placeholder max min multiple pattern required step".split(" "))},getConnectionStatus:function(d,a){a=a?a:"http://www.google.de/images/logos/ps_logo2.png";var b=this;var c=M.ImageView.design({value:a,events:{load:{action:function(f){var e=M.ViewManager.getViewById(f);e.destroy();if(d&&M.EventDispatcher.checkHandler(d,"online")){b.bindToCaller(d.target,d.action,M.ONLINE)()}}},error:{action:function(f){var e=M.ViewManager.getViewById(f);e.destroy();if(d&&M.EventDispatcher.checkHandler(d,"offline")){b.bindToCaller(d.target,d.action,M.OFFLINE)()}}}}});$("body").append(c.render());c.registerEvents()},getUserAgent:function(){return navigator.userAgent},getPlatform:function(){return navigator.platform},getSize:function(){var a;var b;if(typeof window.innerWidth!="undefined"){a=window.innerWidth,b=window.innerHeight}else{if(typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!=0){a=document.documentElement.clientWidth,b=document.documentElement.clientHeight}else{a=document.getElementsByTagName("body")[0].clientWidth,b=document.getElementsByTagName("body")[0].clientHeight}}return[a,b]},getWidth:function(){return this.getSize()[0]},getHeight:function(){return this.getSize()[1]},getTotalSize:function(){return[this.getTotalWidth(),this.getTotalHeight()]},getTotalWidth:function(){return $(document).width()},getTotalHeight:function(){return $(document).height()},getOrientation:function(){switch(window.orientation){case 0:return M.PORTRAIT_TOP;case false:return M.PORTRAIT_BOTTOM;case 90:return M.LANDSCAPE_LEFT;case -90:return M.LANDSCAPE_RIGHT;default:M.Logger.log("This device does not support orientation detection.",M.WARN);return NO}},supportsInputType:function(a){if(this.modernizr.inputtypes&&this.modernizr.inputtypes[a]===YES){return YES}return NO}});m_require("core/foundation/object.js");M.I18N=M.Object.extend({type:"M.I18N",defaultLanguage:"en_us",languageMapper:{de:"de_de",en:"en_us"},l:function(b,a){return this.localize(b,a)},localize:function(b,a){var d;if(!M.Application.currentLanguage){M.Application.currentLanguage=this.getLanguage()}if(this[M.Application.currentLanguage]&&this[M.Application.currentLanguage][b]){d=this[M.Application.currentLanguage][b]}else{if(this[M.Application.defaultLanguage]&&this[M.Application.defaultLanguage][b]){M.Logger.log("Key '"+b+"' not defined for language '"+M.Application.currentLanguage+"', switched to default language '"+M.Application.defaultLanguage+"'",M.WARN);d=this[M.Application.defaultLanguage][b]}else{if(this[this.defaultLanguage]&&this[this.defaultLanguage][b]){M.Logger.log("Key '"+b+"' not defined for language '"+M.Application.currentLanguage+"', switched to system's default language '"+this.defaultLanguage+"'",M.WARN);d=this[this.defaultLanguage][b]}else{M.Logger.log("Key '"+b+"' not defined for both language '"+M.Application.currentLanguage+"' and the system's default language '"+this.defaultLanguage+"'",M.WARN);return null}}}if(a){try{d=_.template(d,a)}catch(c){M.Logger.log('Error in I18N: Check your context object and the translation string with key "'+b+'". Error Message: '+c,M.ERR)}}return d},setLanguage:function(a){if(!this.isLanguageAvailable(a)){M.Logger.log("There is no language '"+a+"' specified (using default language '"+this.defaultLanguage+"' instead!",M.WARN);this.setLanguage(this.defaultLanguage);return}else{if(a&&a===M.Application.currentLanguage){M.Logger.log("Language '"+a+"' already selected",M.INFO);return}}if(localStorage){localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang",a);location.href=location.protocol+"//"+location.host+location.pathname}},getLanguage:function(a){var c=null;if(localStorage){c=localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+"lang")}if(c){return c}else{if(navigator){var b=/([a-zA-Z]{2,3})[\s_.-]?([a-zA-Z]{2,3})?/.exec(navigator.language);if(b&&this[b[0]]){return b[0].toLowerCase()}else{if(b&&b[1]&&this.languageMapper[b[1]]){var c=this.languageMapper[b[1]];return c.toLowerCase()}else{if(M.Application.defaultLanguage){return M.Application.defaultLanguage.toLowerCase()}else{return this.defaultLanguage}}}}else{return this.defaultLanguage}}},isLanguageAvailable:function(a){if(this[a]&&typeof(this[a])==="object"){return true}else{M.Logger.log("no language '"+a+"' specified.",M.WARN);return false}}});m_require("core/foundation/object.js");M.Location=M.Object.extend({type:"M.Location",latitude:null,longitude:null,date:null,accuracy:null,caller:null,onUpdateSuccess:null,onUpdateError:null,init:function(b,a){return this.extend({latitude:b,longitude:a})},update:function(b,d,c,a){this.caller=b;this.onUpdateSuccess=d;this.onUpdateError=c;M.LocationManager.getLocation(this,this.onUpdateSuccessInternal,this.onUpdateErrorInternal,a)},onUpdateSuccessInternal:function(a){if(a&&a.coords){this.latitude=a.coords.latitude;this.longitude=a.coords.longitude;this.date=M.Date.now();if(this.caller){if(this.onUpdateSuccess){this.bindToCaller(this.caller,this.onUpdateSuccess)()}else{M.Logger.log("No success callback specified for update() of M.Location.",M.INFO)}}else{M.Logger.log("No caller specified for update() of M.Location.",M.WARN)}}else{M.Logger.log("An internal error occured while retrieving the position.",M.ERR)}},onUpdateErrorInternal:function(a){if(this.caller){if(this.onUpdateError){this.bindToCaller(this.caller,this.onUpdateError,a)()}else{M.Logger.log("No error callback specified for update() of M.Location.",M.INFO)}}else{M.Logger.log("No caller specified for update() of M.Location.",M.WARN)}}});m_require("core/foundation/object.js");M.FLOOR="floor";M.CEIL="ceil";M.ROUND="round";M.Math=M.Object.extend({type:"M.Math",pow:function(b,a){return Math.pow(b,a)},random:function(b,a){return Math.ceil(Math.random()*(a-b+1)+b-1)},round:function(c,d,a){if(a){c=c*(Math.pow(10,a))}var b=0;switch(d){case M.FLOOR:b=Math.floor(c);break;case M.CEIL:b=Math.ceil(c);break;case M.ROUND:default:b=Math.round(c);break}if(a){var e=String(b/(Math.pow(10,a))).split(".");if(e.length>1){b=parseFloat(e[0]+"."+e[1].substring(0,a))}else{b=parseFloat(e)}}return b}});m_require("core/foundation/object.js");M.StringBuilder=M.Object.extend({type:"M.StringBuilder",strings:null,append:function(c,b){b=typeof(b)==="number"?b:1;if(c){for(var a=1;a<=b;a++){this.strings.push(c)}return YES}},clear:function(){this.strings.length=0},toString:function(){return this.strings.join("")},create:function(b){var a=this.extend({strings:[]});a.append(b);return a}});m_require("core/foundation/object.js");M.UniqueId=M.Object.extend({uuid:function(a,d){var f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");var c=[];d=d||f.length;var b;if(a){for(b=0;b<a;b++){c[b]=f[0|Math.random()*d]}}else{var e;c[8]=c[13]=c[18]=c[23]="-";c[14]="4";for(b=0;b<36;b++){if(!c[b]){e=0|Math.random()*16;c[b]=f[(b==19)?(e&3)|8:e]}}}return c.join("")}});m_require("core/foundation/object.js");M.Base64=M.Object.extend({type:"M.Base64",keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(c){var a="";var k,h,f,j,g,e,d;var b=0;c=M.Cypher.utf8_encode(c);while(b<c.length){k=c.charCodeAt(b++);h=c.charCodeAt(b++);f=c.charCodeAt(b++);j=k>>2;g=((k&3)<<4)|(h>>4);e=((h&15)<<2)|(f>>6);d=f&63;if(isNaN(h)){e=d=64}else{if(isNaN(f)){d=64}}a+=this.keyString.charAt(j)+this.keyString.charAt(g)+this.keyString.charAt(e)+this.keyString.charAt(d)}return a},decode:function(c){var a="";var k,h,f;var j,g,e,d;var b=0;c=c.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(b<c.length){j=this.keyString.indexOf(c.charAt(b++));g=this.keyString.indexOf(c.charAt(b++));e=this.keyString.indexOf(c.charAt(b++));d=this.keyString.indexOf(c.charAt(b++));k=(j<<2)|(g>>4);h=((g&15)<<4)|(e>>2);f=((e&3)<<6)|d;a=a+String.fromCharCode(k);if(e!=64){a=a+String.fromCharCode(h)}if(d!=64){a=a+String.fromCharCode(f)}}return M.Cypher.utf8_decode(a)}});m_require("core/foundation/object.js");M.SHA256=M.Object.extend({type:"M.SHA256",chrsz:8,hexcase:0,hash:function(a){a=M.Cypher.utf8_encode(a);return this.binb2hex(this.core_sha256(this.str2binb(a),a.length*this.chrsz))},safe_add:function(a,d){var c=(a&65535)+(d&65535);var b=(a>>16)+(d>>16)+(c>>16);return(b<<16)|(c&65535)},S:function(b,a){return(b>>>a)|(b<<(32-a))},R:function(b,a){return(b>>>a)},Ch:function(a,c,b){return((a&c)^((~a)&b))},Maj:function(a,c,b){return((a&c)^(a&b)^(c&b))},Sigma0256:function(a){return(this.S(a,2)^this.S(a,13)^this.S(a,22))},Sigma1256:function(a){return(this.S(a,6)^this.S(a,11)^this.S(a,25))},Gamma0256:function(a){return(this.S(a,7)^this.S(a,18)^this.R(a,3))},Gamma1256:function(a){return(this.S(a,17)^this.S(a,19)^this.R(a,10))},core_sha256:function(n,o){var A=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298);var p=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225);var k=new Array(64);var C,B,z,y,w,u,t,s,r,q;var x,v;n[o>>5]|=128<<(24-o%32);n[((o+64>>9)<<4)+15]=o;for(var r=0;r<n.length;r+=16){C=p[0];B=p[1];z=p[2];y=p[3];w=p[4];u=p[5];t=p[6];s=p[7];for(var q=0;q<64;q++){if(q<16){k[q]=n[q+r]}else{k[q]=this.safe_add(this.safe_add(this.safe_add(this.Gamma1256(k[q-2]),k[q-7]),this.Gamma0256(k[q-15])),k[q-16])}x=this.safe_add(this.safe_add(this.safe_add(this.safe_add(s,this.Sigma1256(w)),this.Ch(w,u,t)),A[q]),k[q]);v=this.safe_add(this.Sigma0256(C),this.Maj(C,B,z));s=t;t=u;u=w;w=this.safe_add(y,x);y=z;z=B;B=C;C=this.safe_add(x,v)}p[0]=this.safe_add(C,p[0]);p[1]=this.safe_add(B,p[1]);p[2]=this.safe_add(z,p[2]);p[3]=this.safe_add(y,p[3]);p[4]=this.safe_add(w,p[4]);p[5]=this.safe_add(u,p[5]);p[6]=this.safe_add(t,p[6]);p[7]=this.safe_add(s,p[7])}return p},str2binb:function(d){var c=Array();var a=(1<<this.chrsz)-1;for(var b=0;b<d.length*this.chrsz;b+=this.chrsz){c[b>>5]|=(d.charCodeAt(b/this.chrsz)&a)<<(24-b%32)}return c},binb2hex:function(c){var b=this.hexcase?"0123456789ABCDEF":"0123456789abcdef";var d="";for(var a=0;a<c.length*4;a++){d+=b.charAt((c[a>>2]>>((3-a%4)*8+4))&15)+b.charAt((c[a>>2]>>((3-a%4)*8))&15)}return d}});m_require("core/foundation/request.js");M.INFO=0;M.DEBUG=1;M.WARN=2;M.ERR=3;M.Logger=M.Object.extend({type:"M.Logger",_remoteAccess:YES,log:function(a,b){b=b||M.DEBUG;if(M.Application.getConfig("debugMode")==="false"){return}if(typeof console==="undefined"){window.console={};console.log=console.info=console.warn=console.error=function(){}}switch(b){case M.DEBUG:this.debug(a);break;case M.ERR:this.error(a);break;case M.WARN:this.warn(a);break;case M.INFO:this.info(a);break;default:this.debug(a);break}},debug:function(a){console.debug(a)},error:function(a){console.error(a)},warn:function(a){console.warn(a)},info:function(a){console.info(a)},remote:function(d){var b=this;try{if(b._remoteAccess){var a=JSON.stringify(d);$.ajax({url:"/__espresso_debug_console__",data:a,type:"POST"}).done(function(){b._remoteAccess=YES}).fail(function(){b._remoteAccess=NO})}}catch(c){M.Logger.error(c)}}});m_require("core/utility/logger.js");m_require("core/utility/environment.js");M.EventDispatcher=M.Object.extend({type:"M.EventDispatcher",lastEvent:{},registerEvents:function(c,b,d,a){if(!b||typeof(b)!=="object"){M.Logger.log("No events passed for '"+c+"'!",M.WARN);return}c=this.getEventSource(c);if(!this.checkEventSource(c)){return}_.each(b,function(f,e){M.EventDispatcher.registerEvent(e,c,f,d,a,YES)})},registerEvent:function(f,c,i,b,h,e,a){if(!e){if(!i||typeof(i)!=="object"){M.Logger.log("No event passed!",M.WARN);return}c=this.getEventSource(c);if(!this.checkEventSource(c)){return}}if(!(b&&_.indexOf(b,f)>-1)){if(h&&typeof(h)==="string"){M.Logger.log("Event type '"+f+"' not recommended for "+h+"!",M.WARN)}else{M.Logger.log("Event type '"+f+"' not recommended!",M.WARN)}}if(!this.checkHandler(i,f)){return}if(f==="enter"){c.bind("keyup",function(j){if(j.which===13){$(this).trigger("enter")}})}var d=this;var g=M.ViewManager.getViewById(c.attr("id"));c.bind(f,function(l){if(c.attr("id")&&M.ViewManager.getViewById(c.attr("id")).type==="M.DashboardItemView"){if(d.lastEvent.tap&&d.lastEvent.tap.view==="M.DashboardItemView"&&d.lastEvent.tap.x===l.clientX&&d.lastEvent.tap.y===l.clientY){return}else{if(d.lastEvent.taphold&&d.lastEvent.taphold.view==="M.DashboardItemView"&&d.lastEvent.taphold.x===l.clientX&&d.lastEvent.taphold.y===l.clientY){return}}}var j=YES;if(c.attr("id")){var k=M.ViewManager.getViewById(c.attr("id"));if(k.type==="M.SearchBarView"){j=NO}else{if((f==="click"||f==="tap")&&k.type==="M.ButtonView"&&k.parentView&&k.parentView.type==="M.ToggleView"&&k.parentView.toggleOnClick){j=NO}else{if(k.hyperlinkTarget&&k.hyperlinkType){j=NO}else{if(f==="pageshow"){j=NO}}}}}if(j){l.preventDefault();l.stopPropagation()}if(M.ViewManager.getViewById(c.attr("id"))){d.lastEvent[f]={view:M.ViewManager.getViewById(c.attr("id")).type,date:+new Date(),x:l.clientX,y:l.clientY}}if(i.nextEvent){d.bindToCaller(i.target,i.action,[l.currentTarget.id?l.currentTarget.id:l.currentTarget,l,i.nextEvent])()}else{d.bindToCaller(i.target,i.action,[l.currentTarget.id?l.currentTarget.id:l.currentTarget,l])()}})},unregisterEvents:function(a){a=this.getEventSource(a);if(!this.checkEventSource(a)){return}a.unbind()},unregisterEvent:function(a,b){b=this.getEventSource(b);if(!this.checkEventSource(b)){return}b.unbind(a)},callHandler:function(b,d,a,c){if(!this.checkHandler(b,(d&&d.type?d.type:"undefined"))){return}if(!a){this.bindToCaller(b.target,b.action,c)()}else{this.bindToCaller(b.target,b.action,[d.currentTarget.id?d.currentTarget.id:d.currentTarget,d])()}},checkHandler:function(b,a){if(typeof(b.action)==="string"){if(b.target){if(b.target[b.action]&&typeof(b.target[b.action])==="function"){b.action=b.target[b.action];return YES}else{M.Logger.log("No action '"+b.action+"' found for given target and the event type '"+a+"'!",M.WARN);return NO}}else{M.Logger.log("No valid target passed for action '"+b.action+"' and the event type '"+a+"'!",M.WARN);return NO}}else{if(typeof(b.action)!=="function"){M.Logger.log("No valid action passed for the event type '"+a+"'!",M.WARN);return NO}}return YES},getEventSource:function(a){if(typeof(a)==="string"){a=$("#"+a+":first")}else{a=$(a)}return a},checkEventSource:function(a){if(!a){M.Logger.log("The event source is invalid!",M.WARN);return NO}return YES},dispatchOrientationChangeEvent:function(d,c,b){var a=M.Environment.getOrientation();if(a===M.PORTRAIT_BOTTOM||a===M.PORTRAIT_TOP){$("html").removeClass("landscape");$("html").addClass("portrait")}else{$("html").removeClass("portrait");$("html").addClass("landscape")}$("#"+M.ViewManager.getCurrentPage().id).trigger("orientationdidchange")}});m_require("core/utility/location.js");M.LOCATION_PERMISSION_DENIED="PERMISSION_DENIED";M.LOCATION_POSITION_UNAVAILABLE="POSITION_UNAVAILABLE";M.LOCATION_TIMEOUT="TIMEOUT";M.LOCATION_UNKNOWN_ERROR="UNKNOWN_ERROR";M.LOCATION_NOT_SUPPORTED="NOT_SUPPORTED";M.LOCATION_ALREADY_RECEIVING="ALREADY_RECEIVING";M.LOCATION_TYPE_APPROXIMATE=0;M.LOCATION_TYPE_GEOMETRIC_CENTER=1;M.LOCATION_TYPE_RANGE_INTERPOLATED=2;M.LOCATION_TYPE_ROOFTOP=3;M.LOCATION_GEOCODER_ERROR="ERROR";M.LOCATION_GEOCODER_INVALID_REQUEST="INVALID_REQUEST";M.LOCATION_GEOCODER_OVER_QUERY_LIMIT="OVER_QUERY_LIMIT";M.LOCATION_GEOCODER_REQUEST_DENIED="REQUEST_DENIED";M.LOCATION_GEOCODER_UNKNOWN_ERROR="UNKNOWN_ERROR";M.LOCATION_GEOCODER_ZERO_RESULTS="ZERO_RESULTS";M.LocationManager=M.Object.extend({type:"M.LocationManager",lastLocationUpdate:null,geoCoder:null,isGettingLocation:NO,getLocation:function(b,e,d,a){if(this.isGettingLocation){M.Logger.log("M.LocationManager is currently already trying to retrieve a location.",M.WARN);this.bindToCaller(b,d,M.LOCATION_ALREADY_RECEIVING)()}else{this.isGettingLocation=YES}var c=this;this.lastLocationUpdate=M.Date.now();a=a?a:{};a.enableHighAccuracy=a.enableHighAccuracy?a.enableHighAccuracy:NO;a.maximumAge=a.maximumAge?a.maximumAge:0;a.timeout=a.timeout?a.timeout:3000;if(navigator&&navigator.geolocation){navigator.geolocation.getCurrentPosition(function(f){c.isGettingLocation=NO;if(!a.accuracy||(a.accuracy&&f.coords.accuracy<=a.accuracy)){var g=M.Location.extend({latitude:f.coords.latitude,longitude:f.coords.longitude,accuracy:f.coords.accuracy,date:M.Date.now()});c.bindToCaller(b,e,g)()}else{M.Logger.log("Location retrieved, but accuracy too low: "+f.coords.accuracy,M.INFO);var h=M.Date.now();a.timeout=a.timeout-c.lastLocationUpdate.timeBetween(h);c.getLocation(b,e,d,a)}},function(f){c.isGettingLocation=NO;switch(f.code){case 1:c.bindToCaller(b,d,M.LOCATION_PERMISSION_DENIED)();break;case 2:c.bindToCaller(b,d,M.LOCATION_POSITION_UNAVAILABLE)();break;case 3:c.bindToCaller(b,d,M.LOCATION_TIMEOUT)();break;default:c.bindToCaller(b,d,M.LOCATION_UNKNOWN_ERROR)();break}},a)}else{c.bindToCaller(c,d,M.LOCATION_NOT_SUPPORTED)()}},getLocationByAddress:function(b,e,d,a){if(a&&typeof(a)==="string"){if(!this.geoCoder){this.geoCoder=new google.maps.Geocoder()}var c=this;this.geoCoder.geocode({address:a,language:M.I18N.getLanguage().substr(0,2),region:M.I18N.getLanguage().substr(3,2)},function(g,f){if(f==google.maps.GeocoderStatus.OK){var h=null;_.each(g,function(i){if(!h||M["LOCATION_TYPE_"+h.geometry.location_type]<M["LOCATION_TYPE_"+i.geometry.location_type]){h=i}});if(h){c.bindToCaller(b,e,M.Location.init(h.geometry.location.lat(),h.geometry.location.lng()))()}}else{switch(f){case"ERROR":c.bindToCaller(b,d,M.LOCATION_GEOCODER_ERROR)();break;case"INVALID_REQUEST":c.bindToCaller(b,d,M.LOCATION_GEOCODER_INVALID_REQUEST)();break;case"OVER_QUERY_LIMIT":c.bindToCaller(b,d,M.LOCATION_GEOCODER_OVER_QUERY_LIMIT)();break;case"REQUEST_DENIED":c.bindToCaller(b,d,M.LOCATION_GEOCODER_REQUEST_DENIED)();break;case"ZERO_RESULTS":c.bindToCaller(b,d,M.LOCATION_GEOCODER_ZERO_RESULTS)();break;default:c.bindToCaller(b,d,M.LOCATION_GEOCODER_UNKNOWN_ERROR)();break}}})}},getAddressByLocation:function(b,f,e,a,d){if(a&&typeof(a)==="object"&&a.type==="M.Location"){if(!this.geoCoder){this.geoCoder=new google.maps.Geocoder()}var c=this;this.geoCoder.geocode({location:new google.maps.LatLng(a.latitude,a.longitude),language:M.I18N.getLanguage().substr(0,2),region:M.I18N.getLanguage().substr(3,2)},function(h,g){if(g==google.maps.GeocoderStatus.OK){if(h[0]&&d){var i={};_.each(h[0].address_components,function(j){_.each(j.types,function(k){i[k]=j.long_name?j.long_name:j.short_name})});c.bindToCaller(b,f,i)()}else{if(h[0]){c.bindToCaller(b,f,h[0].formatted_address)()}else{c.bindToCaller(b,e,M.LOCATION_GEOCODER_ZERO_RESULTS)()}}}else{switch(g){case"ERROR":c.bindToCaller(b,e,M.LOCATION_GEOCODER_ERROR)();break;case"INVALID_REQUEST":c.bindToCaller(b,e,M.LOCATION_GEOCODER_INVALID_REQUEST)();break;case"OVER_QUERY_LIMIT":c.bindToCaller(b,e,M.LOCATION_GEOCODER_OVER_QUERY_LIMIT)();break;case"REQUEST_DENIED":c.bindToCaller(b,e,M.LOCATION_GEOCODER_REQUEST_DENIED)();break;case"ZERO_RESULTS":c.bindToCaller(b,e,M.LOCATION_GEOCODER_ZERO_RESULTS)();break;default:c.bindToCaller(b,e,M.LOCATION_GEOCODER_UNKNOWN_ERROR)();break}}})}}});m_require("core/utility/cypher_algorithms/base64.js");m_require("core/utility/cypher_algorithms/sha256.js");M.Cypher=M.Object.extend({type:"M.Cypher",defaultDecoder:M.Base64,defaultEncoder:M.Base64,defaultHasher:M.SHA256,decode:function(b,a){if(a&&a.decode){return a.decode(b)}else{return this.defaultDecoder.decode(b)}},encode:function(b,a){if(a&&a.encode){return a.encode(b)}else{return this.defaultEncoder.encode(b)}},hash:function(b,a){if(a&&a.hash){return a.hash(b)}else{return this.defaultHasher.hash(b)}},utf8_encode:function(a){a=a.replace(/\r\n/g,"\n");var b="";for(var e=0;e<a.length;e++){var d=a.charCodeAt(e);if(d<128){b+=String.fromCharCode(d)}else{if((d>127)&&(d<2048)){b+=String.fromCharCode((d>>6)|192);b+=String.fromCharCode((d&63)|128)}else{b+=String.fromCharCode((d>>12)|224);b+=String.fromCharCode(((d>>6)&63)|128);b+=String.fromCharCode((d&63)|128)}}}return b},utf8_decode:function(d){var a="";var b=0;var e=c1=c2=0;while(b<d.length){e=d.charCodeAt(b);if(e<128){a+=String.fromCharCode(e);b++}else{if((e>191)&&(e<224)){c2=d.charCodeAt(b+1);a+=String.fromCharCode(((e&31)<<6)|(c2&63));b+=2}else{c2=d.charCodeAt(b+1);c3=d.charCodeAt(b+2);a+=String.fromCharCode(((e&15)<<12)|((c2&63)<<6)|(c3&63));b+=3}}}return a}});m_require("core/utility/logger.js");M.DataConsumer=M.Object.extend({type:"M.DataConsumer",responsePath:null,httpMethod:"GET",appendRecords:YES,urlParams:null,configure:function(a){return this.extend(a)},find:function(b){this.include(b);var a=this;M.Request.init({url:this.bindToCaller(this,this.url,_.toArray(this.urlParams))(),isJSON:YES,callbacks:{success:{target:this,action:function(g,f,e){if(g){if(this.responsePath){var d=this.responsePath.split(".");_.each(d,function(h){g=g[h]})}if(g&&!_.isArray(g)||_.isArray(g)&&g.length>0){if(!_.isArray(g)){g=[g]}var c=[];_.each(g,function(i){var h=b.model.createRecord(a.map(i));c.push(h)});if(this.callbacks&&M.EventDispatcher.checkHandler(this.callbacks.success)){M.EventDispatcher.callHandler(this.callbacks.success,null,NO,[c])}}else{M.Logger.log("There were no data sets found in response path '"+this.responsePath+"'.",M.INFO);if(this.callbacks&&M.EventDispatcher.checkHandler(this.callbacks.success)){M.EventDispatcher.callHandler(this.callbacks.success,null,NO,[[]])}}}else{M.Logger.log("There was no data returned for url '"+this.bindToCaller(this,this.url,_.toArray(this.urlParams))()+"'.",M.INFO);if(this.callbacks&&M.EventDispatcher.checkHandler(this.callbacks.success)){M.EventDispatcher.callHandler(this.callbacks.success,null,NO,[[]])}}}},error:{target:this,action:function(d,c){if(this.callbacks&&M.EventDispatcher.checkHandler(this.callbacks.error)){M.EventDispatcher.callHandler(this.callbacks.error,null,NO,c)}}}}}).send()},map:function(a){},url:function(){}});m_require("core/utility/logger.js");M.DataProvider=M.Object.extend({type:"M.DataProvider",isAsync:NO,find:function(a){},save:function(){},del:function(){},check:function(a,b){return a[b]?YES:NO}});M.TARGET_REMOTE="remote";M.TARGET_LOCAL="local";M.TARGET_BOTH="both";M.PRIO_REMOTE="prio_remote";M.PRIO_LOCAL="prio_local";M.PRIO_BOTH="prio_both";m_require("core/utility/logger.js");M.DataProviderHybrid=M.Object.extend({type:"M.DataProviderHybrid",isAsync:YES,localProvider:null,remoteProvider:null,usedProviders:0,callbackCounter:0,onSuccess:null,onError:null,callbacks:{success:{local:null,remote:null},error:{local:null,remote:null}},config:null,configure:function(a){var b=this.extend({config:a});if(!b.config.local){throw M.Error.extend({code:M.ERR_MODEL_PROVIDER_NOT_SET,msg:"No local data provider passed"})}if(!b.config.remote){throw M.Error.extend({code:M.ERR_MODEL_PROVIDER_NOT_SET,msg:"No remote data provider passed"})}b.localProvider=b.config.local;b.remoteProvider=b.config.remote;return b},find:function(a){this.crud(a,"find")},save:function(a){this.crud(a,"save")},del:function(a){this.crud(a,"del")},crud:function(a,b){a.target=a.target||M.TARGET_BOTH;if(!a.prio){if(a.target===M.TARGET_BOTH){a.prio=M.PRIO_BOTH}else{if(a.target===M.TARGET_LOCAL){a.prio=M.PRIO_LOCAL}else{if(a.target===M.PRIO_REMOTE){a.prio=M.PRIO_REMOTE}}}}this.callbackCounter=0;this.setOriginCallbacks(a);this.setIntermediateCallbacks(a);switch(a.target){case M.TARGET_LOCAL:this.usedProviders=1;this.localProvider[b](a);break;case M.TARGET_REMOTE:this.usedProviders=1;this.remoteProvider[b](a);break;case M.TARGET_BOTH:this.usedProviders=2;this.localProvider[b](a);this.remoteProvider[b](a);break}},setOriginCallbacks:function(a){if(a.onSuccess&&a.onSuccess.target&&a.onSuccess.action){a.onSuccess=this.bindToCaller(a.onSuccess.target,a.onSuccess.target[a.onSuccess.action]);this.onSuccess=a.onSuccess}else{if(a.onSuccess==="function"){this.onSuccess=a.onSuccess}}if(a.onError&&a.onError.target&&a.onError.action){a.onError=this.bindToCaller(a.onError.target,a.onError.target[a.onSuccess.action]);this.onError=a.onError}else{if(a.onError==="function"){this.onError=a.onError}}},setIntermediateCallbacks:function(a){a.onSuccess={target:this,action:"handleSuccessCallback"};a.onError={target:this,action:"handleErrorCallback"}},handleSuccessCallback:function(a,b,c){if(c.type===this.localProvider.type){this.callbacks.success.local={result:a,param:b,dataProvider:c}}else{if(c.type===this.remoteProvider.type){this.callbacks.success.remote={result:a,param:b,dataProvider:c}}}this.callbackCounter=this.callbackCounter+1;if(this.callbackCounter===this.usedProviders){this.calculateOperationState()}},handleErrorCallback:function(a,b,c){if(c.type===this.localProvider.type){this.callbacks.error.local={err:a,param:b,dataProvider:c}}else{if(c.type===this.remoteProvider.type){this.callbacks.error.remote={err:a,param:b,dataProvider:c};b.model.state_remote=M.STATE_FAIL}}this.callbackCounter=this.callbackCounter+1;if(this.callbackCounter===this.usedProviders){this.calculateOperationState()}},calculateOperationState:function(a){switch(a.prio){case M.PRIO_LOCAL:if(!this.callbacks.success.local){this.onError(this.error.local.err,a)}else{this.onSuccess(this.success.local.result,a)}case M.PRIO_REMOTE:if(!this.callbacks.error.local){this.onError(this.error.remote.err,a)}else{this.onSuccess(this.success.remote.result,a)}case M.PRIO_BOTH:if(!this.callbacks.success.local||!this.callbacks.success.remote){this.onError(this.error.remote.err,a)}else{this.onSuccess(this.success.remote.result,a)}break}}});m_require("core/utility/logger.js");M.ModelAttribute=M.Object.extend({type:"M.ModelAttribute",dataType:null,isRequired:NO,isUpdated:NO,validators:null,refEntity:null,validate:function(c){var b=YES;for(var a in this.validators){if(!this.validators[a].validate(c)){b=NO}}return b}});M.ModelAttribute.attr=function(a,b){if(!b){b={}}if(!b.dataType){b.dataType=a||"String"}if(!b.validators&&b.isRequired){b.validators=[]}if(b.isRequired){if(_.select(b.validators,function(c){return c.type==="M.PresenceValidator"}).length===0){b.validators.push(M.PresenceValidator)}}return this.extend(b)};m_require("core/utility/logger.js");M.Validator=M.Object.extend({type:"M.Validator",validationErrors:[],customize:function(a){return this.extend(a)},clearErrorBuffer:function(){this.validationErrors.length=0}});m_require("core/utility/logger.js");M.ERR_UNDEFINED=0;M.ERR_CONNECTION=1;M.ERR_VALIDATION_PRESENCE=100;M.ERR_VALIDATION_URL=101;M.ERR_VALIDATION_PHONE=102;M.ERR_VALIDATION_NUMBER=103;M.ERR_VALIDATION_NOTMINUS=104;M.ERR_VALIDATION_EMAIL=105;M.ERR_VALIDATION_DATE=106;M.ERR_MODEL_PROVIDER_NOT_SET=120;M.ERR_WEBSQL_UNKNOWN=200;M.ERR_WEBSQL_DATABASE=201;M.ERR_WEBSQL_VERSION=202;M.ERR_WEBSQL_TOO_LARGE=203;M.ERR_WEBSQL_QUOTA=204;M.ERR_WEBSQL_SYNTAX=205;M.ERR_WEBSQL_CONSTRAINT=206;M.ERR_WEBSQL_TIMEOUT=207;M.ERR_WEBSQL_PROVIDER_NO_DBHANDLER=208;M.ERR_WEBSQL_BULK_NO_RECORDS=210;M.ERR_COUCHDB_CONFLICT=300;M.ERR_COUCHDB_DBNOTFOUND=301;M.ERR_COUCHDB_DBEXISTS=302;M.ERR_COUCHDB_DOCNOTFOUND=303;M.Error=M.Object.extend({code:"",msg:"",errObj:null});M.STATE_UNDEFINED="state_undefined";M.STATE_NEW="state_new";M.STATE_INSYNCPOS="state_insyncpos";M.STATE_INSYNCNEG="state_insyncneg";M.STATE_LOCALCHANGED="state_localchange";M.STATE_VALID="state_valid";M.STATE_INVALID="state_invalid";M.STATE_DELETED="state_deleted";m_require("core/utility/logger.js");M.Model=M.Object.extend({type:"M.Model",name:"",m_id:null,record:null,__meta:{},recordManager:null,modelList:{},state:M.STATE_UNDEFINED,state_remote:M.STATE_UNDEFINED,usesValidation:NO,dataProvider:null,getUniqueId:function(){return M.UniqueId.uuid(4)},createRecord:function(b){var c=this.extend({m_id:b.m_id?b.m_id:this.getUniqueId(),record:b});delete b.m_id;c.state=b.state?b.state:M.STATE_NEW;delete b.state;if(c.state===M.STATE_NEW){c.record[M.META_CREATED_AT]=+new Date();c.record[M.META_UPDATED_AT]=+new Date()}for(var a in c.record){if(a===M.META_CREATED_AT||a===M.META_UPDATED_AT){continue}if(!c.__meta.hasOwnProperty(a)){M.Logger.log('Deleting "'+a+"\" property. It's not part of "+this.name+" definition.",M.WARN);delete c.record[a];continue}if(c.__meta[a].dataType==="Reference"&&c.record[a]&&c.record[a].type&&c.record[a].type==="M.Model"){c.set(a,c.record[a])}if(c.__meta[a]){c.__meta[a].isUpdated=NO}}this.recordManager.add(c);return c},create:function(b,d){var a=M.Model.extend({__meta:{},name:b.__name__,dataProvider:d,recordManager:{},usesValidation:b.usesValidation?b.usesValidation:this.usesValidation});delete b.__name__;delete b.usesValidation;for(var c in b){if(typeof(b[c])==="function"){a[c]=b[c]}else{if(b[c].type==="M.ModelAttribute"){a.__meta[c]=b[c]}}}a.__meta[M.META_CREATED_AT]=this.attr("String",{isRequired:YES});a.__meta[M.META_UPDATED_AT]=this.attr("String",{isRequired:YES});a.recordManager=M.RecordManager.extend({records:[]});this.modelList[a.name]=a;return a},hasOne:function(b,a){var c=this.attr("Reference",{refType:"toOne",reference:b,validators:a.validators,isRequired:a.isRequired});return c},hasMany:function(b,c,a){var d=this.attr("Reference",{refType:"toMany",reference:c});return d},attr:function(a,b){return M.ModelAttribute.attr(a,b)},get:function(c,d){var a=this.__meta[c];var f=this.record[c];if(a&&a.dataType==="Reference"){if(a.refEntity){return a.refEntity}else{if(f){if(d&&d.force){var e=this.dataProvider.isAsync?d.onSuccess:null;this.deepFind([{prop:c,name:a.reference,model:this.modelList[a.reference],m_id:f}],e);if(!this.dataProvider.isAsync){return a.refEntity}return YES}else{var b=this.recordManager.getRecordById(f);if(b){return b}else{return NO}}}else{return null}}}return f},set:function(a,b){if(this.__meta[a].dataType==="Reference"&&b.type&&b.type==="M.Model"){if(this.record[a]!==b.m_id){this.record[a]=b.m_id;this.__meta[a].refEntity=b}return}if(this.record[a]!==b){this.record[a]=b;this.__meta[a].isUpdated=YES;this.record[M.META_UPDATED_AT]=+new Date()}},records:function(){if(this.recordManager&&this.recordManager.records){return this.recordManager.records}},validate:function(){var e=YES;var a=NO;M.Validator.clearErrorBuffer();var b=this.state===M.STATE_NEW?this.__meta:this.record;for(var c in b){if(c==="ID"){continue}var f=this.__meta[c];var d={value:this.record[c],modelId:this.name+"_"+this.m_id,property:c};if(!f.validate(d)){e=NO}}return e},find:function(a){if(!this.dataProvider){M.Logger.log("No data provider given.",M.ERR)}a=a?a:{};a.deleteRecordList=a.deleteRecordList?a.deleteRecordList:YES;if(a.deleteRecordList){this.recordManager.removeAll()}if(!this.dataProvider){M.Logger.log("No data provider given.",M.ERR)}return this.dataProvider.find($.extend(a,{model:this}))},save:function(b){if(!this.dataProvider){M.Logger.log("No data provider given.",M.ERR)}b=b?b:{};if(!this.m_id){return NO}var a=YES;if(this.usesValidation){a=this.validate()}if(b.cascade){for(var c in this.__meta){if(this.__meta[c]&&this.__meta[c].dataType==="Reference"&&this.__meta[c].refEntity){this.__meta[c].refEntity.save({cascade:YES})}}}if(a){return this.dataProvider.save($.extend(b,{model:this}))}},del:function(b){if(!this.dataProvider){M.Logger.log("No data provider given.",M.ERR)}b=b?b:{};if(!this.m_id){return NO}var a=this.dataProvider.del($.extend(b,{model:this}));if(a){this.state=M.STATE_DELETED;return YES}},complete:function(c){var a=[];for(var b in this.record){if(this.__meta[b].dataType==="Reference"){a.push({prop:b,name:this.__meta[b].reference,model:this.modelList[this.__meta[b].reference],m_id:this.record[b]})}}this.deepFind(a,c)},deepFind:function(b,f){if(b.length<1){if(f){f()}return}var c=b.pop();var a=this.bindToCaller(this,this.deepFind,[b,f]);var e=this;switch(this.dataProvider.type){case"M.DataProviderLocalStorage":var d=this.modelList[c.name].find({key:c.m_id});this.__meta[c.prop].refEntity=d;this.deepFind(b,f);break;default:break}},setReference:function(a,b,d,c){b.__meta[d].refEntity=a[0];c()}});m_require("core/utility/logger.js");M.Observable=M.Object.extend({type:"M.Observable",bindingList:null,attach:function(a,b){if(!this.bindingList){this.bindingList=[]}this.bindingList.push({observer:a,observable:b})},detach:function(a){this.bindlingList=$.grep(this.bindlingList,function(c,b){return c.observer!==a})},notifyObservers:function(a){_.each(this.bindingList,function(b){if(a===b.observable||(b.observable.indexOf(".")>0&&b.observable.indexOf(a)>-1)){b.observer.contentDidChange()}else{if(a.indexOf(".")>0&&b.observable.indexOf(a.substring(0,a.lastIndexOf(".")))===0){b.observer.contentDidChange()}}})}});m_require("core/datastore/data_provider.js");M.DataProviderDummy=M.DataProvider.extend({find:function(){M.Logger.log("DummyProvider does not support find().",M.WARN)},save:function(){M.Logger.log("DummyProvider does not support save().",M.WARN)},del:function(){M.Logger.log("DummyProvider does not support del().",M.WARN)}});m_require("core/datastore/data_provider.js");M.DataProviderLocalStorage=M.DataProvider.extend({type:"M.DataProviderLocalStorage",save:function(c){try{var a=JSON.stringify(c.model.record);localStorage.setItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+c.model.name+"_"+c.model.m_id,a);return YES}catch(b){M.Logger.log("Error saving "+c.model.record+" to localStorage with key: "+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+c.model.name+"_"+this.m_id,M.WARN);M.Logger.log("Error "+b.code+", "+b.name+": "+b.message);return NO}},del:function(b){try{if(localStorage.getItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+b.model.name+"_"+b.model.m_id)){localStorage.removeItem(M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+b.model.name+"_"+b.model.m_id);b.model.recordManager.remove(b.model.m_id);return YES}return NO}catch(a){M.Logger.log("Error removing key: "+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+b.model.name+"_"+b.model.m_id+" from localStorage",M.WARN);return NO}},find:function(j){if(j.key){var n=this.findByKey(j);if(!n){return NO}var d=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+j.model.name+"_([0-9a-zA-Z]+)$").exec(j.key);var g=d&&d[1]?d[1]:null;if(!g){M.Logger.log("retrieved model has no valid key: "+j.key,M.ERR);return NO}var f=j.model.createRecord($.extend(n,{m_id:g,state:M.STATE_VALID}));return f}if(j.query){var a=j.query;var l=[];if(!a.identifier){l.push("identifier")}if(!a.operator){l.push("operator")}if(a.value===undefined||a.value===null){l.push("value")}if(l.length>0){M.Logger.log("Wrong query format:",l.join(", ")," is/are missing.",M.WARN);return[]}var k=a.identifier;var p=a.operator;var e=a.value;var r=this.findAll(j);if(r&&r.length>0){var c=r[0];if(typeof(c.record[k])!=c.__meta[k].dataType.toLowerCase()){if(!(c.__meta[k].dataType.toLowerCase()=="reference"&&typeof(c.record[k])=="string")){throw'Query: "'+k+p+e+'" tries to compare '+typeof(c.record[k])+" with "+c.__meta[k].dataType.toLowerCase()+"."}}}switch(p){case"=":r=_.select(r,function(i){return i.record[k]===e});break;case"~=":if(j.model.__meta[k].dataType.toLowerCase()!=="string"){throw'Query: Operator "~=" only works on string properties. Property "'+k+'" is of type '+j.model.__meta[k].dataType.toLowerCase()+"."}var b=["\\\\","\\*","\\+","\\?","\\|","\\{","\\}","\\[","\\]","\\(","\\)","\\^","\\$","\\.","\\#"];for(var h in b){e=e.replace(new RegExp(b[h],"g"),"\\"+b[h].substring(1,2))}e=e.replace(/\s/g,"\\s");var s=new RegExp(e);r=_.select(r,function(i){return s.test(i.record[k])});break;case"!=":r=_.select(r,function(i){return i.record[k]!==e});break;case"<":r=_.select(r,function(i){return i.record[k]<e});break;case">":r=_.select(r,function(i){return i.record[k]>e});break;case"<=":r=_.select(r,function(i){return i.record[k]<=e});break;case">=":r=_.select(r,function(i){return i.record[k]>=e});break;default:M.Logger.log("Query has unknown operator: "+p,M.WARN);r=[];break}return r}else{return this.findAll(j)}},findByKey:function(b){if(b.key){var a=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX);b.key=a.test(b.key)?b.key:M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+b.model.name+"_"+b.key;if(localStorage.getItem(b.key)){return this.buildRecord(b.key,b)}else{return NO}}M.Logger.log("Please provide a key.",M.WARN);return NO},findAll:function(h){var b=[];for(var e=0;e<localStorage.length;e++){var d=localStorage.key(e);regexResult=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+h.model.name+"_").exec(d);if(regexResult){var c=this.buildRecord(d,h);var f=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+h.model.name+"_([0-9a-zA-Z]+)$").exec(d);var g=f&&f[1]?f[1]:null;if(!g){M.Logger.log("Model Record m_id not correct: "+g,M.ERR);continue}var a=h.model.createRecord($.extend(c,{m_id:g,state:M.STATE_VALID}));b.push(a)}}return b},buildRecord:function(c,d){var a=JSON.parse(localStorage.getItem(c));for(var b in a){if(d.model.__meta[b]&&typeof(a[b])!==d.model.__meta[b].dataType.toLowerCase()){switch(d.model.__meta[b].dataType){case"Date":a[b]=M.Date.create(a[b]);break}}}return a},allKeys:function(d){var c=[];for(var b=0;b<localStorage.length;b++){var a=localStorage.key(b);regexResult=new RegExp("^"+M.LOCAL_STORAGE_PREFIX+M.Application.name+M.LOCAL_STORAGE_SUFFIX+d.model.name+"_").exec(a);if(regexResult){c.push(a)}}return c}});m_require("core/datastore/data_provider.js");M.DataProviderRemoteStorage=M.DataProvider.extend({type:"M.DataProviderRemoteStorage",config:null,save:function(e){var c=this.config[e.model.name];var a=null;var b=null;if(e.model.state===M.STATE_NEW){b=c.create.map(e.model.record);this.remoteQuery("create",c.url+c.create.url(e.model.get("ID")),c.create.httpMethod,b,e,null)}else{b=c.update.map(e.model.record);var d=c.url+c.update.url(e.model.get("ID"));this.remoteQuery("update",d,c.update.httpMethod,b,e,function(f){f.setRequestHeader("X-Http-Method-Override",c.update.httpMethod)})}},del:function(c){var a=this.config[c.model.name];var b=a.del.url(c.model.get("ID"));b=a.url+b;this.remoteQuery("delete",b,a.del.httpMethod,null,c,function(d){d.setRequestHeader("X-Http-Method-Override",a.del.httpMethod)})},find:function(b){var a=this.config[b.model.name];var c=b.ID?a.read.url.one(b.ID):a.read.url.all();c=a.url+c;this.remoteQuery("read",c,a.read.httpMethod,null,b)},createModelsFromResult:function(e,g,f){var a=[];var b=this.config[f.model.name];if(_.isArray(e)){for(var d in e){var c=e[d];a.push(f.model.createRecord($.extend(b.read.map(c),{state:M.STATE_VALID})))}}else{if(typeof(e)==="object"){a.push(f.model.createRecord($.extend(b.read.map(e),{state:M.STATE_VALID})))}}g(a)},remoteQuery:function(c,b,e,g,h,d){var f=this;var a=this.config[h.model.name];M.Request.init({url:b,method:e,isJSON:YES,contentType:"application/JSON",data:g?g:null,onSuccess:function(i,k,j){if(c==="delete"){h.model.recordManager.remove(h.model.m_id)}if(c==="create"){if(a.create.receiveIdentifier){a.create.receiveIdentifier(i,h.model)}else{M.Logger.log("No ID receiving operation defined.")}}if(h.onSuccess){if(h.onSuccess.target&&h.onSuccess.action){h.onSuccess=f.bindToCaller(h.onSuccess.target,h.onSuccess.target[h.onSuccess.action],[i]);if(c==="read"){f.createModelsFromResult(i,h.onSuccess,h)}else{h.onSuccess()}}else{if(typeof(h.onSuccess)==="function"){f.createModelsFromResult(i,h.onSuccess,h)}}}else{M.Logger.log("No success callback given.",M.WARN)}},onError:function(k,j){var i=M.Error.extend({code:M.ERR_CONNECTION,msg:j});if(h.onError&&typeof(h.onError)==="function"){h.onError(i)}if(h.onError&&h.onError.target&&h.onError.action){h.onError=this.bindToCaller(h.onError.target,h.onError.target[h.onError.action],i);h.onError()}else{if(typeof(h.onError)!=="function"){M.Logger.log("No error callback given.",M.WARN)}}},beforeSend:d?d:null}).send()},configure:function(a){console.log("configure() called.");return this.extend({config:a})}});m_require("core/datastore/validator.js");M.DateValidator=M.Validator.extend({type:"M.DateValidator",patternDateUS:/^([0-9]{2})\/([0-9]{2})\/([0-9]{4})(\s+([0-9]{2})\:([0-9]{2})(\:([0-9]{2}))?)?$/,patternDateDE:/^([0-9]{2})\.([0-9]{2})\.([0-9]{4})(\s+([0-9]{2})\:([0-9]{2})(\:([0-9]{2}))?)?$/,validate:function(c,a){if(c.isView){if(c.value===null||c.value===undefined||c.value===""||!(this.patternDateUS.test(c.value)||this.patternDateDE.test(c.value))||!M.Date.create(c.value)){var b=M.Error.extend({msg:this.msg?this.msg:a+" is not a valid date.",code:M.ERR_VALIDATION_DATE,errObj:{msg:this.msg?this.msg:a+" is not a valid date.",viewId:c.id,validator:"DATE",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(b);return NO}return YES}else{if(c.value.type&&c.value.type!=="M.Date"&&(c.value===null||c.value===undefined||c.value===""||!M.Date.create(c.value))){var b=M.Error.extend({msg:this.msg?this.msg:c.property+" is not a valid date.",code:M.ERR_VALIDATION_DATE,errObj:{msg:this.msg?this.msg:c.property+" is not a valid date.",modelId:c.modelId,validator:"DATE",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(b);return NO}return YES}}});m_require("core/datastore/validator.js");M.EmailValidator=M.Validator.extend({type:"M.EmailValidator",pattern:/^((?:(?:(?:\w[\.\-\+]?)*)\w)+)\@((?:(?:(?:\w[\.\-\+]?){0,62})\w)+)\.(\w{2,6})$/,validate:function(b){if(typeof(b.value)!=="string"){return NO}if(this.pattern.test(b.value)){return YES}var a=M.Error.extend({msg:this.msg?this.msg:b.value+" is not a valid email adress.",code:M.ERR_VALIDATION_EMAIL,errObj:{msg:b.value+" is not a valid email adress.",modelId:b.modelId,property:b.property,viewId:b.viewId,validator:"EMAIL",onSuccess:b.onSuccess,onError:b.onError}});this.validationErrors.push(a);return NO}});m_require("core/datastore/validator.js");M.NotMinusValidator=M.Validator.extend({type:"M.NotMinusValidator",validate:function(c){if(typeof(c.value)==="number"){if(c.value<0){var a=M.Error.extend({msg:this.msg?this.msg:c.value+" is a minus value. This is not allowed.",code:M.ERR_VALIDATION_NOTMINUS,errObj:{msg:c.value+" is a minus value. This is not allowed.",modelId:c.modelId,property:c.property,viewId:c.viewId,validator:"NUMBER",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(a);return NO}return YES}if(typeof(c.value)==="string"){var b=/-/;if(this.pattern.exec(c.value)){var a=M.Error.extend({msg:this.msg?this.msg:c.value+" is a minus value. This is not allowed.",code:M.ERR_VALIDATION_NOTMINUS,errObj:{msg:c.value+" is a minus value. This is not allowed.",modelId:c.modelId,property:c.property,viewId:c.viewId,validator:"NUMBER",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(a);return NO}return YES}}});m_require("core/datastore/validator.js");M.NumberValidator=M.Validator.extend({type:"M.NumberValidator",validate:function(b){if(typeof(b.value)==="number"){return YES}if(typeof(b.value)==="string"&&(parseInt(b.value)==b.value||parseFloat(b.value)==b.value)){return YES}var a=M.Error.extend({msg:this.msg?this.msg:b.value+" is not a number.",code:M.ERR_VALIDATION_NUMBER,errObj:{msg:b.value+" is not a number.",modelId:b.modelId,property:b.property,viewId:b.viewId,validator:"NUMBER",onSuccess:b.onSuccess,onError:b.onError}});this.validationErrors.push(a);return NO}});m_require("core/datastore/validator.js");M.PhoneValidator=M.Validator.extend({type:"M.PhoneValidator",pattern:/^[0-9-\/()+\.\s]+$/,validate:function(b){if(typeof(b.value!=="string")){return NO}if(this.pattern.exec(b.value)){return YES}var a=M.Error.extend({msg:this.msg?this.msg:b.value+" is not a phone number.",code:M.ERR_VALIDATION_PHONE,errObj:{msg:b.value+" is not a phone number.",modelId:b.modelId,property:b.property,viewId:b.viewId,validator:"PHONE",onSuccess:b.onSuccess,onError:b.onError}});this.validationErrors.push(a);return NO}});m_require("core/datastore/validator.js");M.PresenceValidator=M.Validator.extend({type:"M.PresenceValidator",validate:function(c,a){if(c.value===null||c.value===undefined||c.value===""){if(c.isView){var b=M.Error.extend({msg:this.msg?this.msg:a+" is required and is not set.",code:M.ERR_VALIDATION_PRESENCE,errObj:{msg:this.msg?this.msg:a+" is required and is not set.",viewId:c.id,validator:"PRESENCE",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(b)}else{var b=M.Error.extend({msg:this.msg?this.msg:c.property+"is required and is not set.",code:M.ERR_VALIDATION_PRESENCE,errObj:{msg:this.msg?this.msg:c.property+" is required and is not set.",modelId:c.modelId,property:c.property,validator:"PRESENCE",onSuccess:c.onSuccess,onError:c.onError}});this.validationErrors.push(b)}return NO}return YES}});m_require("core/datastore/validator.js");M.UrlValidator=M.Validator.extend({type:"M.UrlValidator",pattern:/^(http[s]\:\/\/)?[a-zA-Z0-9\-\.]+\.[a-zA-Z]{2,3}(\/\S*)?$/,validate:function(b){if(typeof(b.value!=="string")){return NO}if(this.pattern.exec(b.value)){return YES}var a=M.Error.extend({msg:this.msg?this.msg:b.value+" is not a valid url.",code:M.ERR_VALIDATION_URL,errObj:{msg:b.value+" is not a valid url.",modelId:b.modelId,property:b.property,viewId:b.viewId,validator:"PHONE",onSuccess:b.onSuccess,onError:b.onError}});this.validationErrors.push(a);return NO}});m_require("core/foundation/model.js");M.RecordManager=M.Object.extend({type:"M.RecordManager",records:[],add:function(a){this.records.push(a)},addMany:function(a){if(_.isArray(a)){this.records=this.records.concat(a)}else{if(a.type==="M.Model"){this.add(a)}}},removeAll:function(){this.records.length=0},remove:function(a){if(!a){M.Logger.log("No id given.",M.WARN);return}var b=this.getRecordById(a);if(b){this.records=_.select(this.records,function(c){return c.m_id!==b.m_id})}delete b},getRecordForId:function(a){return this.getRecordById(a)},getRecordById:function(b){var a=_.detect(this.records,function(c){return c.m_id===b});return a},dumpRecords:function(){_.each(this.records,function(a){console.log(a)})}});m_require("core/foundation/model.js");M.View=M.Object.extend({type:"M.View",isView:YES,value:null,computedValue:null,contentBinding:null,contentBindingReverse:null,childViews:null,hasFocus:NO,id:null,isInline:NO,isEnabled:YES,parentView:null,modelId:null,cssClass:null,cssStyle:null,cssClassOnError:null,cssClassOnInit:null,html:"",triggerActionOnChange:NO,triggerActionOnKeyUp:NO,triggerActionOnEnter:NO,events:null,internalEvents:null,recommendedEvents:null,parentPage:null,design:function(b){var a=this.extend(b);a.id=M.ViewManager.getNextId();M.ViewManager.register(a);a.attachToObservable();return a},render:function(){this.renderChildViews();return this.html},renderUpdate:function(){},renderChildViews:function(){if(this.childViews){var b=this.getChildViewsAsArray();for(var a in b){if(this[b[a]]){this[b[a]]._name=b[a];this[b[a]].parentView=this;this.html+=this[b[a]].render()}else{this.childViews=this.childViews.replace(b[a]," ");M.Logger.log("There is no child view '"+b[a]+"' available for "+this.type+" ("+(this._name?this._name+", ":"")+"#"+this.id+")! It will be excluded from the child views and won't be rendered.",M.WARN)}if(this.type==="M.PageView"&&this[b[a]].type==="M.TabBarView"){this.hasTabBarView=YES;this.tabBarView=this[b[a]]}}return this.html}},removeChildViews:function(){var b=this.getChildViewsAsArray();for(var a in b){if(this[b[a]].childViews){this[b[a]].removeChildViews()}this[b[a]].destroy();M.ViewManager.unregister(this[b[a]])}$("#"+this.id).empty()},getChildViewsAsArray:function(){return $.trim(this.childViews.replace(/\s+/g," ")).split(" ")},getValues:function(){var a={};if(this.childViews){var e=this.getChildViewsAsArray();for(var c in e){if(Object.getPrototypeOf(this[e[c]]).hasOwnProperty("getValue")){a[e[c]]=this[e[c]].getValue()}if(this[e[c]].childViews){var b=this[e[c]].getValues();for(var d in b){a[d]=b[d]}}}}return a},getValue:function(){},getIds:function(){var b={};if(this.childViews){var c=this.getChildViewsAsArray();for(var a in c){if(this[c[a]].id){b[c[a]]=this[c[a]].id}if(this[c[a]].childViews){var e=this[c[a]].getIds();for(var d in e){b[d]=e[d]}}}}return b},clearHtml:function(){this.html="";if(this.childViews){var b=this.getChildViewsAsArray();for(var a in b){this[b[a]].clearHtml()}}},computeValue:function(){if(this.computedValue){this.value=this.computedValue.operation(this.computedValue.valuePattern?this.value:this.computedValue.value,this)}},theme:function(){this.themeChildViews()},registerEvents:function(){var a={};for(var c in this.events){if(c==="orientationchange"){c="orientationdidchange"}a[c]=this.events[c]}if(this.internalEvents){for(var c in this.internalEvents){if(this.internalEvents[c]){if(c==="orientationchange"){this.internalEvents.orientationdidchange=this.internalEvents[c];delete this.internalEvents[c]}}}}if(this.internalEvents&&a){for(var c in a){if(this.internalEvents[c]){this.internalEvents[c].nextEvent=a[c];delete a[c]}}M.EventDispatcher.registerEvents(this.id,this.internalEvents,this.recommendedEvents,this.type)}else{if(this.internalEvents){M.EventDispatcher.registerEvents(this.id,this.internalEvents,this.recommendedEvents,this.type)}}if(a){M.EventDispatcher.registerEvents(this.id,a,this.recommendedEvents,this.type)}if(this.childViews){var d=this.getChildViewsAsArray();for(var b in d){this[d[b]].registerEvents()}}},themeChildViews:function(){if(this.childViews){var b=this.getChildViewsAsArray();for(var a in b){this[b[a]].theme()}}},contentDidChange:function(){var a=this.contentBinding?this.contentBinding:(this.computedValue)?this.computedValue.contentBinding:null;if(!a){return}var b=a.target;var c=a.property.split(".");_.each(c,function(d){if(b){b=b[d]}});if(b===undefined||b===null){M.Logger.log("The value assigned by content binding (property: '"+a.property+"') for "+this.type+" ("+(this._name?this._name+", ":"")+"#"+this.id+") is invalid!",M.WARN);return}if(this.contentBinding){this.value=b}else{if(this.computedValue.contentBinding){this.computedValue.value=b}}this.renderUpdate();this.delegateValueUpdate()},attachToObservable:function(){var a=this.contentBinding?this.contentBinding:(this.computedValue)?this.computedValue.contentBinding:null;if(!a){return}if(typeof(a)==="object"){if(a.target&&typeof(a.target)==="object"){if(a.property&&typeof(a.property)==="string"){var b=a.property.split(".");if(a.target[b[0]]!==undefined){if(!a.target.observable){a.target.observable=M.Observable.extend({})}a.target.observable.attach(this,a.property);this.isObserver=YES}else{M.Logger.log("The specified target for contentBinding for '"+this.type+"' ("+(this._name?this._name+", ":"")+"#"+this.id+")' has no property '"+a.property+"!",M.WARN)}}else{M.Logger.log("The type of the value of 'action' in contentBinding for '"+this.type+"' ("+(this._name?this._name+", ":"")+"#"+this.id+")' is '"+typeof(a.property)+" but it must be of type 'string'!",M.WARN)}}else{M.Logger.log("No valid target specified in content binding '"+this.type+"' ("+(this._name?this._name+", ":"")+"#"+this.id+")!",M.WARN)}}else{M.Logger.log("No valid content binding specified for '"+this.type+"' ("+(this._name?this._name+", ":"")+"#"+this.id+")!",M.WARN)}},setValueFromDOM:function(){},delegateValueUpdate:function(){if(this.contentBindingReverse&&this.hasFocus){this.contentBindingReverse.target.set(this.contentBindingReverse.property,this.value)}},style:function(){},gotFocus:function(){this.hasFocus=YES},lostFocus:function(){this.hasFocus=NO},secure:function(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;")},nl2br:function(a){if(a){if(typeof(a)!=="string"){a=String(a)}return a.replace(/\n/g,"<br />")}return a},tab2space:function(a){if(a){if(typeof(a)!=="string"){a=String(a)}return a.replace(/\t/g,"&#160;&#160;&#160;&#160;")}return a},clearValue:function(){},clearValues:function(){if(this.childViews){var b=this.getChildViewsAsArray();for(var a in b){if(this[b[a]].childViews){this[b[a]].clearValues()}if(typeof(this[b[a]].clearValue)==="function"){this[b[a]].clearValue()}}}this.clearValue()},addCssClass:function(a){$("#"+this.id).addClass(a)},removeCssClass:function(a){$("#"+this.id).removeClass(a)},setCssProperty:function(a,b){$("#"+this.id).css(a,b)},removeCssProperty:function(a){this.setCssProperty(a,"")},getParentPage:function(){if(this.parentPage){return this.parentPage}else{if(this.type==="M.PageView"){return this}else{if(this.parentView){this.parentPage=this.parentView.getParentPage()}else{var a=$("#"+this.id).parent().closest("[id^=m_]").attr("id");if(a){this.parentPage=M.ViewManager.getViewById(a).getParentPage()}}}return this.parentPage}}});M.TRANSITION={};M.TRANSITION.NONE="none";M.TRANSITION.SLIDE="slide";M.TRANSITION.SLIDEUP="slideup";M.TRANSITION.SLIDEDOWN="slidedown";M.TRANSITION.POP="pop";M.TRANSITION.FADE="fade";M.TRANSITION.FLIP="flip";m_require("core/foundation/observable.js");M.Controller=M.Object.extend({type:"M.Controller",observable:null,switchToTab:function(c){if(!(c.parentView&&c.parentView.type==="M.TabBarView")){M.Logger.log("Please provide a valid tab bar item to the switchToTab method.",M.WARN);return}var d=c.parentView.activeTab;var b=M.ViewManager.getPage(c.page);c.parentView.setActiveTab(c);if(c===d){var a=M.ViewManager.getCurrentPage();if(a!==b){this.switchToPage(b,null,YES,NO)}}else{this.switchToPage(b,M.TRANSITION.NONE,NO,YES)}},switchToPage:function(b,e,a,d){var c=M.Date.now();b=b&&typeof(b)==="object"?b:M.ViewManager.getPage(b);if(b){e=e?e:M.TRANSITION.SLIDE;a=a!==undefined?a:NO;d=d!==undefined?d:YES;if(b.type==="M.PageView"){$.mobile.changePage($("#"+b.id),{transition:M.Application.getConfig("useTransitions")?e:M.TRANSITION.NONE,reverse:M.Application.getConfig("useTransitions")?a:NO,changeHash:d,showLoadMsg:NO})}M.ViewManager.setCurrentPage(b)}else{M.Logger.log('Page "'+b+'" not found',M.ERR)}},set:function(c,d){var e=c.split(".");if(e.length===1){this[c]=d}else{var b=(this[e[0]]=this[e[0]]?this[e[0]]:{});for(var a=1;a<e.length-1;a++){b=(b[e[a]]=b[e[a]]?b[e[a]]:{})}b[e[e.length-1]]=d}if(!this.observable){return}this.observable.notifyObservers(c)}});m_require("core/foundation/view.js");M.ViewManager=M.Object.extend({type:"M.ViewManager",nextId:0,idPrefix:"m_",viewList:{},pageList:{},currentPage:null,currentlyRenderedPage:null,foundView:null,getNextId:function(){this.nextId=this.nextId+1;return this.idPrefix+this.nextId},register:function(a){this.viewList[a.id]=a;if(a.type==="M.PageView"){this.pageList[a.id]=a}},unregister:function(a){delete this.viewList[a.id]},getViewById:function(a){return this.viewList[a]},findViewById:function(a){return this.getViewById(a)},getIdByView:function(a){return a.id},getView:function(c,b){if(typeof(c)!=="object"){c=M.Application.pages[c]?M.Application.pages[c]:(M.ViewManager.getViewById(c)?M.ViewManager.getViewById(c):null)}var a=null;this.foundView=null;if(c){a=this.findView(c,b)}if(!a){M.Logger.log("view '"+b+"' not found.",M.WARN)}return a},findView:function(c,a){if(c.childViews){var d=c.getChildViewsAsArray();for(var b in d){if(a===d[b]){this.foundView=c[a];return this.foundView}else{this.findView(c[d[b]],a)}}}return this.foundView},getPage:function(a){var b=M.Application.pages[a];if(!b){M.Logger.log("page '"+a+"' not found.",M.WARN)}return b},getCurrentPage:function(){return this.currentPage},setCurrentPage:function(a){this.currentPage=a},dumpViewList:function(){_.each(this.viewList,function(a){console.log(a.id+": "+a.type)})}});m_require("core/foundation/view_manager.js");M.Application=M.Object.extend({type:"M.Application",name:null,currentLanguage:null,defaultLanguage:null,isFirstLoad:YES,entryPage:null,config:{},design:function(c){var b={};for(var a in c){if(c[a]&&c[a].type==="M.PageView"){b[a]=c[a]}}this.include({pages:b});this.entryPage=((c.entryPage&&typeof(c.entryPage)==="string")?c.entryPage:null);return this},main:function(){var a=this;var b=M.ViewManager.getPage(M.Application.entryPage.replace(/\s+/g,""));delete M.ViewManager.viewList[b.id];delete M.ViewManager.pageList[b.id];b.id="m_entryPage";b.render();M.ViewManager.setCurrentPage(b);_.each(M.ViewManager.pageList,function(c){c.render()});M.ViewManager.viewList.m_entryPage=b;M.ViewManager.pageList.m_entryPage=b},getConfig:function(a){if(this.config[a]){return this.config[a]}return null}});